<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migración al Sistema de Lotes - SIMETRIC GYM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #880808;
            text-align: center;
            border-bottom: 3px solid #880808;
            padding-bottom: 15px;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #880808;
            border-radius: 5px;
        }
        .step h3 {
            color: #880808;
            margin-top: 0;
        }
        .command-box {
            background: #1a1a1a;
            color: #f2f3d9;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .problem {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
        }
        .solution {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 Migración al Sistema de Lotes</h1>
        
        <div class="error">
            <strong>❌ Problemas Detectados:</strong>
            <ul>
                <li>La tabla <code>movimientos_stock</code> no tiene la columna <code>lote_id</code></li>
                <li>Los productos registrados no crean lotes automáticamente</li>
                <li>El stock aparece en 0 porque se calcula desde lotes inexistentes</li>
            </ul>
        </div>

        <div class="solution">
            <strong>✅ Solución:</strong> Ejecutar script de migración para actualizar la estructura de la base de datos y migrar productos existentes al sistema de lotes.
        </div>

        <div class="step">
            <h3>🚀 Paso 1: Ejecutar Migración</h3>
            <p>Ejecuta el siguiente comando para migrar la base de datos:</p>
            <div class="command-box">
node migracion-lotes.js
            </div>
            <p><strong>Este script hará:</strong></p>
            <ul>
                <li>✅ Crear la tabla <code>lotes</code> si no existe</li>
                <li>✅ Actualizar <code>movimientos_stock</code> con columna <code>lote_id</code></li>
                <li>✅ Migrar productos existentes con stock > 0 a lotes</li>
                <li>✅ Crear movimientos de stock para la migración</li>
            </ul>
        </div>

        <div class="step">
            <h3>📊 Paso 2: Verificar Migración</h3>
            <p>Después de ejecutar el script, verifica que:</p>
            <ul>
                <li>🔍 Los productos muestren el stock correcto</li>
                <li>🔍 Se puedan registrar nuevas compras sin errores</li>
                <li>🔍 El historial de lotes funcione correctamente</li>
                <li>🔍 Los nuevos productos creen lotes automáticamente</li>
            </ul>
        </div>

        <div class="step">
            <h3>🆕 Cambios en el Registro de Productos</h3>
            <p>El módulo de registro ahora:</p>
            <ul>
                <li>✅ Crea automáticamente un lote inicial si el stock > 0</li>
                <li>✅ Registra el movimiento de stock correspondiente</li>
                <li>✅ Usa transacciones para garantizar consistencia</li>
                <li>✅ Muestra información del lote creado</li>
            </ul>
        </div>

        <div class="warning">
            <strong>⚠️ Importante:</strong>
            <ul>
                <li>Haz un respaldo de la base de datos antes de ejecutar la migración</li>
                <li>La migración es automática y segura, pero siempre es bueno tener respaldo</li>
                <li>Los productos existentes se migrarán con un lote inicial</li>
                <li>El proveedor de productos migrados será "Migración automática"</li>
            </ul>
        </div>

        <div class="step">
            <h3>🔄 Flujo Después de la Migración</h3>
            
            <h4>📦 Registro de Productos:</h4>
            <ol>
                <li>Se crea el producto en la tabla <code>productos</code></li>
                <li>Si tiene stock inicial > 0, se crea un lote en <code>lotes</code></li>
                <li>Se registra el movimiento en <code>movimientos_stock</code></li>
                <li>El stock se calcula desde los lotes activos</li>
            </ol>

            <h4>🛒 Nueva Compra:</h4>
            <ol>
                <li>Se crea un nuevo lote independiente</li>
                <li>Se registra el movimiento de entrada</li>
                <li>El stock total se actualiza automáticamente</li>
                <li>Se mantiene la trazabilidad por lote</li>
            </ol>
        </div>

        <div class="success">
            <strong>🎉 Beneficios del Sistema de Lotes:</strong>
            <ul>
                <li>🎯 Control preciso de costos por lote</li>
                <li>📊 Trazabilidad completa de productos</li>
                <li>💰 Cálculo exacto de rentabilidad</li>
                <li>🔄 Preparado para lógica PEPS en ventas</li>
                <li>📈 Historial detallado de movimientos</li>
            </ul>
        </div>

        <div class="step">
            <h3>🧪 Pruebas Recomendadas</h3>
            <p>Después de la migración, prueba:</p>
            <ol>
                <li>✅ Registrar un producto nuevo con stock inicial</li>
                <li>✅ Realizar una nueva compra de un producto existente</li>
                <li>✅ Ver el historial de lotes en gestión de inventario</li>
                <li>✅ Verificar que el stock se calcule correctamente</li>
            </ol>
        </div>
    </div>
</body>
</html>
